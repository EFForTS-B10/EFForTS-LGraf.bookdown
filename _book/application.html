<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Application examples | EFForTS-LGraf Manual</title>
  <meta name="description" content="Software manual for Landscape Generator EFForTS-LGraf" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Application examples | EFForTS-LGraf Manual" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Software manual for Landscape Generator EFForTS-LGraf" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Application examples | EFForTS-LGraf Manual" />
  
  <meta name="twitter:description" content="Software manual for Landscape Generator EFForTS-LGraf" />
  

<meta name="author" content="Jan Salecker" />


<meta name="date" content="2019-10-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="funcpar.html"/>
<link rel="next" href="dummy-chapter.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EFForTS-LGraf manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to EFForTS-LGraf</a></li>
<li class="chapter" data-level="2" data-path="getstarted.html"><a href="getstarted.html"><i class="fa fa-check"></i><b>2</b> Get started</a><ul>
<li class="chapter" data-level="2.1" data-path="getstarted.html"><a href="getstarted.html#prerequisites"><i class="fa fa-check"></i><b>2.1</b> Prerequisites</a></li>
<li class="chapter" data-level="2.2" data-path="getstarted.html"><a href="getstarted.html#basic-functions"><i class="fa fa-check"></i><b>2.2</b> Basic Functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="funcpar.html"><a href="funcpar.html"><i class="fa fa-check"></i><b>3</b> Functionality and Parameterization</a><ul>
<li class="chapter" data-level="3.1" data-path="funcpar.html"><a href="funcpar.html#functionality"><i class="fa fa-check"></i><b>3.1</b> Functionality</a></li>
<li class="chapter" data-level="3.2" data-path="funcpar.html"><a href="funcpar.html#parameterization"><i class="fa fa-check"></i><b>3.2</b> Parameterization</a><ul>
<li class="chapter" data-level="3.2.1" data-path="funcpar.html"><a href="funcpar.html#setup-landscape-and-households"><i class="fa fa-check"></i><b>3.2.1</b> Setup landscape and households</a></li>
<li class="chapter" data-level="3.2.2" data-path="funcpar.html"><a href="funcpar.html#establish-fields"><i class="fa fa-check"></i><b>3.2.2</b> Establish fields</a></li>
<li class="chapter" data-level="3.2.3" data-path="funcpar.html"><a href="funcpar.html#distribute-crops"><i class="fa fa-check"></i><b>3.2.3</b> Distribute crops</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="funcpar.html"><a href="funcpar.html#using-custom-road-shapefiles"><i class="fa fa-check"></i><b>3.3</b> Using custom road shapefiles</a></li>
<li class="chapter" data-level="3.4" data-path="funcpar.html"><a href="funcpar.html#efforts-lgraf-output-functions"><i class="fa fa-check"></i><b>3.4</b> EFForTS-LGraf output functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="application.html"><a href="application.html"><i class="fa fa-check"></i><b>4</b> Application examples</a><ul>
<li class="chapter" data-level="4.1" data-path="application.html"><a href="application.html#standalone"><i class="fa fa-check"></i><b>4.1</b> Standalone application examples</a><ul>
<li class="chapter" data-level="4.1.1" data-path="application.html"><a href="application.html#fromscratch"><i class="fa fa-check"></i><b>4.1.1</b> Example 1: A landscape from scratch</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="application.html"><a href="application.html#nlrx"><i class="fa fa-check"></i><b>4.2</b> Application examples using nlrx</a><ul>
<li class="chapter" data-level="4.2.1" data-path="application.html"><a href="application.html#example-1-gradient-of-agricultural-density"><i class="fa fa-check"></i><b>4.2.1</b> Example 1: Gradient of agricultural density</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dummy-chapter.html"><a href="dummy-chapter.html"><i class="fa fa-check"></i><b>5</b> Dummy chapter</a></li>
<li class="chapter" data-level="6" data-path="dummy-chapter-1.html"><a href="dummy-chapter-1.html"><i class="fa fa-check"></i><b>6</b> Dummy chapter</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EFForTS-LGraf Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="application" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Application examples</h1>
<p>In this section you will find several application examples for EFForTS-LGraf.
These range from very detailed examples, covering all aspects of parameterization and output creation (e.g., <a href="application.html#fromscratch">4.1.1</a>) to small little snippets explaining only some important aspects of EFForTS-LGraf.
The examples are structured in two sections. Examples in section <a href="application.html#standalone">4.1</a> show how EFForTS-LGraf can be used as a standalone tool using only NetLogo. Examples in section <a href="application.html#nlrx">4.2</a> show how the R package nlrx can be used to automate landscape creation.</p>
<div id="standalone" class="section level2">
<h2><span class="header-section-number">4.1</span> Standalone application examples</h2>
<div id="fromscratch" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Example 1: A landscape from scratch</h3>
<div id="step-1-prerequisites" class="section level4">
<h4><span class="header-section-number">4.1.1.1</span> Step 1: Prerequisites</h4>
<p>In order to use EFForTS-LGraf as a standalone tool, you only need to adjust the parameters to your needs (see Section <a href="funcpar.html#funcpar">3</a>).
Here we will show you a simple example of how this can be done.</p>
<p>Lets imagine we performed a household survey of smallholder farmers and explicitly asked for:</p>
<ul>
<li>size of their fields (which also gives us the total size of each household)</li>
<li>crop types on their fields</li>
</ul>
<p>From remote sensing we estimate:</p>
<ul>
<li>road density/road length within study area</li>
<li>field area of villages</li>
</ul>
</div>
<div id="step-2-parameterize-and-execute-road-and-household-setup" class="section level4">
<h4><span class="header-section-number">4.1.1.2</span> Step 2: Parameterize and execute road and household setup</h4>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="figures/EFForTS-LGraf_interface_I.png" alt="Setup parameters" width="386" />
<p class="caption">
Figure 4.1: Setup parameters
</p>
</div>
<p>We now want to create maps along an intensity gradient with similar characteristics and need to parameterize EFForTS-LGraf:</p>
<ul>
<li>We want reproducible maps, thus we set <code>reproducible?</code> to TRUE and select a <code>random-seed</code> (1.1)</li>
<li>Our cell size should be 50x50m and we want to simulate maps with 100x100 cells (1.2)</li>
<li>Because we do not have road data, We use an artifical road creation algorithm (1.3, <code>artificial.perlin</code>)</li>
<li>We set the number of road cells we want to create (1.3.2)</li>
<li>Because we want to create maps along an intensity gradient, we choose the setup-type <code>agricultural-area</code> (1.6). We can then define the proportion of agricultural area our resulting map should have (1.7). E.g., we can create three maps, with increasing proportion of agricultural area.</li>
<li>We calculate a household size distribution from our survey and use it to parameterize 1.8
<ul>
<li>log-normal distribution, mean = 1 ha, sd = 0.5ha</li>
</ul></li>
<li>We calculate a village area distribution from our survey and use it to parameterize 1.9
<ul>
<li>normal distribution, mean = 50ha, sd = 3ha</li>
</ul></li>
<li>We expect that one percent of the area is covered by large company plantations. We use the inaccessible area feature to create these plantations by setting the <code>inaccessible-area-fraction</code> to 0.1 (1.12)</li>
</ul>
<p>Once all these parameters are porperly defined, press the button “I. Setup landscape and households” to execute model initialization.
This procedure will setup the initial landscape with roads, villages, households and inaccessible areas as specified.</p>
</div>
<div id="step-3-parameterize-and-execute-field-establishment" class="section level4">
<h4><span class="header-section-number">4.1.1.3</span> Step 3: Parameterize and execute field establishment</h4>
<div class="figure"><span id="fig:unnamed-chunk-7"></span>
<img src="figures/EFForTS-LGraf_interface_II.png" alt="Field establishment parameters" width="388" />
<p class="caption">
Figure 4.2: Field establishment parameters
</p>
</div>
<p>During model initialization, households have been created with a specific household area, drawn from the household area distribution.
During the field establishment procedure, households will realize this household area by establishing fields. Each time a household establishes a field, a field size will be drawn from the defined distribution. More details on field establishment can be found in the accompanying publication.</p>
<ul>
<li>Next, we calculate the field size distribution from our survey and use it to parameterize 2.1
<ul>
<li>log-normal distribution, mean = 0.49 ha, sd = 0.77 ha</li>
<li>Because we want to use these dsitribution values, it is important to turn <code>use-field-size-percentage</code> off, otherwise the mean of the distribution would be estimated depending on the defined household area distribution.</li>
</ul></li>
<li>We want to use all available field estaiblishment strategies (2.4) and define that households change strategies after 2 unsuccessful tries (2.6)</li>
</ul>
<p>Once all these parameters are porperly defined, press the button “II. Establish fields” to execute field establishment.</p>
</div>
<div id="step-4-parameterize-and-execute-crop-distribution" class="section level4">
<h4><span class="header-section-number">4.1.1.4</span> Step 4: Parameterize and execute crop distribution</h4>
<div class="figure"><span id="fig:unnamed-chunk-8"></span>
<img src="figures/EFForTS-LGraf_interface_III.png" alt="Crop distribution parameters" width="386" />
<p class="caption">
Figure 4.3: Crop distribution parameters
</p>
</div>
<ul>
<li>Finally, from our survey we estimated a proportion of 50% rubber and 50% oilpalm on fields. We set the parameters accordingly (3.1, 3.2). Because we do not want to consider any specialization, we set the <code>land-use-types</code> parameter to <code>landscape-level-fraction</code> mode, which just distributes the fractions to the fields as accurately as possible and does not consider any specialization levels.</li>
</ul>
<p>Once all these parameters are properly defined, press the button “III. Distribute crops” to distribute crops to all fields in the landscape.</p>
</div>
<div id="step-5-investigate-landscape-and-output" class="section level4">
<h4><span class="header-section-number">4.1.1.5</span> Step 5: Investigate landscape and output</h4>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="figures/EFForTS-LGraf_interface_output.png" alt="Output" width="693" />
<p class="caption">
Figure 4.4: Output
</p>
</div>
<p>EFForTS-LGraf provides several ways to investigate model output:</p>
<ul>
<li>Performance
<ul>
<li>In box “V. Model output”, the switch <code>print-messages?</code> can be activated to print a model performance report after each procedure execution. This report will tell you detailed information on current procedures. For example, the report will warn you if some of the specified landscape parameters could not be realized.</li>
<li>In box “IV. Paint &amp; Output”, the switch <code>write-param-file?</code> can be activated to automatically store a parameter file of the current run. This can be useful for debugging purposes. The file will be saved in the main output folder as defined in the input field <code>foldername</code>. You can only define a folder name that is already existing in the main directory of EFForTS-LGraf (e.g. <code>output</code>).</li>
</ul></li>
<li>Paint
<ul>
<li>In box “IV. Paint &amp; Output”, two main painting functions are available to display generated maps:</li>
<li><code>paint.default.map</code> will apply a predefined color scheme on the current map. The scheme can be selected from the drop-down menu below the button.</li>
<li><code>paint.all</code> lets you define a custom color scheme. You can choose from several cell variables, add labels and turn on/off certain spatial features.</li>
<li><code>create-3D-map</code> is an experimental feature that allows to spawn NetLogo agents in different shapes and colors (trees, houses) to create a 3-dimensional version of the landscape. Currently, this function displays palms and trees to represent typical crops of our case study region in Jambi, Indonesia. However, with little code adjustments, other crop types can be displayed in a similar fashion. After exeucting the button, right click on the world view and select <code>Switch to 3D View</code>.</li>
</ul></li>
<li>Plot
<ul>
<li>In box “V. Model output” several plots give you some information about expected and realized size distributions of households, villages, fields and inaccessible areas. You can also check if the defined crop proportions could be realized within the generated landscape.</li>
</ul></li>
<li>Export
<ul>
<li>In box “IV. Paint &amp; Output” you can store the current landscape as ascii/shp files by pressing the button <code>write output</code>. In order to define a location for output files, you need to enter an already existing subfolder directory in the <code>foldername</code> input field.</li>
</ul></li>
</ul>
</div>
<div id="step-6-export-output-and-load-spatial-data-into-r" class="section level4">
<h4><span class="header-section-number">4.1.1.6</span> Step 6: Export output and load spatial data into R</h4>
<p>We might want to write our map to disk and load it into R to perform further analysis.
First, we need to set the projection and gis envelope of the landscape:</p>
<ul>
<li>For example, we want to map the landscape to the envelope of the provided jambi1 road file. Thus, we define <code>gis-envelope</code> as <code>[238244 243244 9789775 9794775]</code> and activate <code>apply-gis-envelope?</code></li>
<li>Next, we use the projection file of the jambi1 road map to define the projection system. Thus, we define <code>gis-projection</code> as <code>input/LGraf_roadmaps/jambi1_road.prj</code> and activate <code>apply-gis-projection?</code></li>
<li>In order to use the default output folder, we define <code>foldername</code> as <code>output</code> and press the button <code>write output</code></li>
</ul>
<p>These files can now be loaded into R as spatial objects:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(landscapetools)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">roads &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">read_sf</span>(<span class="st">&quot;1_Model/EFForTS-LGraf/output/roads_polyline_layer.shp&quot;</span>) </a>
<a class="sourceLine" id="cb1-7" title="7">hhs &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">read_sf</span>(<span class="st">&quot;1_Model/EFForTS-LGraf/output/hh_points_layer.shp&quot;</span>) </a>
<a class="sourceLine" id="cb1-8" title="8">lut &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">raster</span>(<span class="st">&quot;1_Model/EFForTS-LGraf/output/land-use-type-raster.asc&quot;</span>), <span class="dt">xy=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>lut, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>land.use.type.raster)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>roads, <span class="dt">color=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>hhs, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="st">  </span><span class="kw">theme_nlm</span>()</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-11"></span>
<img src="figures/application_standalone01_fig01.png" alt="Plot generated landscape in R" width="350" />
<p class="caption">
Figure 4.5: Plot generated landscape in R
</p>
</div>
</div>
</div>
</div>
<div id="nlrx" class="section level2">
<h2><span class="header-section-number">4.2</span> Application examples using nlrx</h2>
<p>All following examples use the <a href="https://github.com/ropensci/nlrx">nlrx package</a> to generate maps with EFForTS-LGraf, directly from R. This can be beneficial if many different maps with varying parameters need to be created. More detailed information on nlrx can be found on the <a href="https://ropensci.github.io/nlrx/">nlrx documentation homepage</a>.</p>
<div id="example-1-gradient-of-agricultural-density" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Example 1: Gradient of agricultural density</h3>
<p>Here we show a simple example for creating maps along a gradient of road length, agricultural proportion and crop types.
This example can be easily adjusted.</p>
<div id="step-1-nl-object" class="section level4">
<h4><span class="header-section-number">4.2.1.1</span> Step 1: nl object</h4>
<p>The nlrx package uses nl objects to store all relevant information that is needed for executing NetLogo simulations in one place.
We always start with defining such an nl object and enter the directories where NetLogo itself and the model files are located.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(nlrx)</a>
<a class="sourceLine" id="cb2-2" title="2">netlogopath &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;1_Model/NetLogo 6.0.4/&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">modelpath &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;1_Model/EFForTS-LGraf/EFForTS-LGraf.nlogo&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5">nl &lt;-<span class="st"> </span><span class="kw">nl</span>(<span class="dt">nlversion =</span> <span class="st">&quot;6.0.4&quot;</span>,</a>
<a class="sourceLine" id="cb2-6" title="6">         <span class="dt">nlpath =</span> netlogopath,</a>
<a class="sourceLine" id="cb2-7" title="7">         <span class="dt">modelpath =</span> modelpath,</a>
<a class="sourceLine" id="cb2-8" title="8">         <span class="dt">jvmmem =</span> <span class="dv">2024</span>)</a></code></pre></div>
</div>
<div id="step-2-attach-an-experiment" class="section level4">
<h4><span class="header-section-number">4.2.1.2</span> Step 2: attach an experiment</h4>
<p>Next, we need to attach an experiment object to this nl object.
The experiment defines which buttons are pressed for startup (<code>idsetup</code>) and model execution (<code>idgo</code>).
We only want to run one repetition for each parameterisation (<code>repetitions=1</code>) and we only want to take one measurement at the end of the simulation (<code>tickmetrics="false"</code>).
We also define which measurements we want to take. Here we measure coordinates, landuse type and road of each patch in the landscape (<code>metrics.patches = c("pxcor", "pycor", "p_landuse-type", "p_road")</code>).
The variables slot, defines parameters which should be varied on each run. We want to create maps, representing a gradient of agricultural area, road length and crop types. We use the values vector to define three runs. The first will have 10% agricultural area, with 200 road cells and a 10% proportion of crop type 1. The second run will have 40% agricultural area, with 400 road cells and a 40% proportion of crop type 1. The third run will have 70% agricultural area, with 600 road cells and a 70% proportion of crop type 1. The remaining proportion of crop types will be filled up with crop type 2, because we set <code>"LUT-fill-up" = "\"LUT-2-fraction\""</code> in the constants list of the experiment.
All other parameters, that should be constant on each run are also entered in this constants list.</p>
<p>There are many more options on designing experiments with nlrx (see the manual for more options).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">nl<span class="op">@</span>experiment &lt;-<span class="st"> </span><span class="kw">experiment</span>(<span class="dt">expname=</span><span class="st">&quot;LGraf&quot;</span>,</a>
<a class="sourceLine" id="cb3-2" title="2">                            <span class="dt">outpath=</span><span class="kw">file.path</span>(<span class="st">&quot;3_Data&quot;</span>),</a>
<a class="sourceLine" id="cb3-3" title="3">                            <span class="dt">repetition=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-4" title="4">                            <span class="dt">tickmetrics=</span><span class="st">&quot;false&quot;</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">                            <span class="dt">idsetup=</span><span class="kw">c</span>(<span class="st">&quot;setup&quot;</span>),</a>
<a class="sourceLine" id="cb3-6" title="6">                            <span class="dt">idgo=</span><span class="kw">c</span>(<span class="st">&quot;establish_fields&quot;</span>, <span class="st">&quot;assign-land-uses&quot;</span>),</a>
<a class="sourceLine" id="cb3-7" title="7">                            <span class="dt">metrics.patches=</span><span class="kw">c</span>(<span class="st">&quot;pxcor&quot;</span>, <span class="st">&quot;pycor&quot;</span>, <span class="st">&quot;p_landuse-type&quot;</span>, <span class="st">&quot;p_road&quot;</span>),</a>
<a class="sourceLine" id="cb3-8" title="8">                            <span class="dt">variables =</span> <span class="kw">list</span>(<span class="st">&quot;proportion-agricultural-area&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.7</span>)),</a>
<a class="sourceLine" id="cb3-9" title="9">                                             <span class="st">&quot;total-road-length&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">400</span>, <span class="dv">600</span>)),</a>
<a class="sourceLine" id="cb3-10" title="10">                                             <span class="st">&quot;LUT-1-fraction&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.7</span>))),</a>
<a class="sourceLine" id="cb3-11" title="11">                            <span class="dt">constants =</span> <span class="kw">list</span>(<span class="st">&quot;households-per-cell&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">                                             <span class="st">&quot;setup-model&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">agricultural-area</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-13" title="13">                                             <span class="st">&quot;reproducable?&quot;</span> =<span class="st"> &quot;FALSE&quot;</span>,   <span class="co">## random seed is set via nlrx</span></a>
<a class="sourceLine" id="cb3-14" title="14">                                             <span class="st">&quot;write.param.file?&quot;</span> =<span class="st"> &quot;FALSE&quot;</span>, <span class="co">## useful for debugging</span></a>
<a class="sourceLine" id="cb3-15" title="15">                                             <span class="st">&quot;width&quot;</span> =<span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb3-16" title="16">                                             <span class="st">&quot;height&quot;</span> =<span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb3-17" title="17">                                             <span class="st">&quot;cell-length-meter&quot;</span> =<span class="st"> </span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb3-18" title="18">                                             <span class="st">&quot;road.algorithm&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">artificial.perlin</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-19" title="19">                                             <span class="st">&quot;min-dist-roads&quot;</span> =<span class="st"> </span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">                                             <span class="st">&quot;perlin-octaves&quot;</span> =<span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-21" title="21">                                             <span class="st">&quot;perlin-persistence&quot;</span> =<span class="st"> </span><span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb3-22" title="22">                                             <span class="st">&quot;cone-angle&quot;</span> =<span class="st"> </span><span class="dv">90</span>,</a>
<a class="sourceLine" id="cb3-23" title="23">                                             <span class="st">&quot;dist-weight&quot;</span> =<span class="st"> </span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb3-24" title="24">                                             <span class="st">&quot;occ-probability&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-25" title="25">                                             <span class="st">&quot;hh-area-mean-ha&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-26" title="26">                                             <span class="st">&quot;hh-area-sd-ha&quot;</span> =<span class="st"> </span><span class="fl">0.91</span>,</a>
<a class="sourceLine" id="cb3-27" title="27">                                             <span class="st">&quot;hh-area-distribution&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">log-normal</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-28" title="28">                                             <span class="st">&quot;vlg-area-distribution&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">uniform</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-29" title="29">                                             <span class="st">&quot;vlg-area-mean&quot;</span> =<span class="st"> </span><span class="dv">15</span>,</a>
<a class="sourceLine" id="cb3-30" title="30">                                             <span class="st">&quot;vlg-area-sd&quot;</span> =<span class="st"> </span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb3-31" title="31">                                             <span class="st">&quot;min-distance&quot;</span> =<span class="st"> </span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb3-32" title="32">                                             <span class="st">&quot;field-size-distribution&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">log-normal</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-33" title="33">                                             <span class="st">&quot;use-field-size-percentage?&quot;</span> =<span class="st"> &quot;FALSE&quot;</span>,</a>
<a class="sourceLine" id="cb3-34" title="34">                                             <span class="st">&quot;field-size-percentage&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-35" title="35">                                             <span class="st">&quot;field-size-mean-ha&quot;</span> =<span class="st"> </span><span class="fl">0.49</span>,</a>
<a class="sourceLine" id="cb3-36" title="36">                                             <span class="st">&quot;field-size-sd-ha&quot;</span> =<span class="st"> </span><span class="fl">0.77</span>,</a>
<a class="sourceLine" id="cb3-37" title="37">                                             <span class="st">&quot;set-field-strategies-by-id?&quot;</span> =<span class="st"> &quot;TRUE&quot;</span>,</a>
<a class="sourceLine" id="cb3-38" title="38">                                             <span class="st">&quot;field-strategies-id&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-39" title="39">                                             <span class="st">&quot;change-strategy&quot;</span> =<span class="st"> </span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb3-40" title="40">                                             <span class="st">&quot;field.shape.factor&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-41" title="41">                                             <span class="st">&quot;inaccessible-area-fraction&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-42" title="42">                                             <span class="st">&quot;LUT-1-name&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">oilpalm</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-43" title="43">                                             <span class="st">&quot;LUT-2-name&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">rubber</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-44" title="44">                                             <span class="st">&quot;LUT-2-fraction&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-45" title="45">                                             <span class="st">&quot;LUT-3-fraction&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-46" title="46">                                             <span class="st">&quot;LUT-4-fraction&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-47" title="47">                                             <span class="st">&quot;LUT-5-fraction&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-48" title="48">                                             <span class="st">&quot;LUT-1-specialize&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-49" title="49">                                             <span class="st">&quot;LUT-2-specialize&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-50" title="50">                                             <span class="st">&quot;LUT-3-specialize&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-51" title="51">                                             <span class="st">&quot;LUT-4-specialize&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-52" title="52">                                             <span class="st">&quot;LUT-5-specialize&quot;</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-53" title="53">                                             <span class="st">&quot;LUT-fill-up&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">LUT-2-fraction</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-54" title="54">                                             <span class="st">&quot;land-use-types&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">household-level-specialization</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-55" title="55">                                             <span class="st">&quot;default.maps&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">landuse-type</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-56" title="56">                                             <span class="st">&quot;write-household-ids&quot;</span> =<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">only-first-households</span><span class="ch">\&quot;</span><span class="st">&quot;</span>))</a></code></pre></div>
</div>
<div id="step-3-attach-a-simdesign" class="section level4">
<h4><span class="header-section-number">4.2.1.3</span> Step 3: attach a simdesign</h4>
<p>While the experiment defines the parameters that should be varied, the simdesign creates a parameter matrix from this information.
In our case, we defined distinct values using the values vector, thus we need to add a simdesign_distinct to our nl object.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Add a distinct simdesign</span></a>
<a class="sourceLine" id="cb4-2" title="2">nl<span class="op">@</span>simdesign &lt;-<span class="st"> </span><span class="kw">simdesign_distinct</span>(<span class="dt">nl=</span>nl, <span class="dt">nseeds=</span><span class="dv">1</span>)</a></code></pre></div>
</div>
<div id="step-4-execute-simulations" class="section level4">
<h4><span class="header-section-number">4.2.1.4</span> Step 4: Execute simulations</h4>
<p>Now, the nl object is complete and can be used to execute model simulations with EFForTS-LGraf.
We only need to execute <code>run_nl_all(nl)</code> to run these simulations.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Run all three simulations</span></a>
<a class="sourceLine" id="cb5-2" title="2">results &lt;-<span class="st"> </span><span class="kw">run_nl_all</span>(nl)</a></code></pre></div>
</div>
<div id="step-5-postprocessing" class="section level4">
<h4><span class="header-section-number">4.2.1.5</span> Step 5: Postprocessing</h4>
<p>The simdesign object within the nl object provides an empty slot for storing output data of simulations.
Attaching output data to the nl object allows to have all information of a simulation in one object.
It also enables to use several post-processing functions of nlrx, such as converting patch.metrics to spatial raster files.
Here, we first attach the results to the nl object, convert the spatial data to raster files and create a plot of land-use types and road cells for each of our three model runs.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Attach results to nl object:</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">setsim</span>(nl, <span class="st">&quot;simoutput&quot;</span>) &lt;-<span class="st"> </span>results</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co"># Convert spatial data to raster stacks</span></a>
<a class="sourceLine" id="cb6-5" title="5">nl_sp &lt;-<span class="st"> </span><span class="kw">nl_to_raster</span>(nl)</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co"># Combine roads and landuse raster and plot:</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="kw">png</span>(<span class="st">&quot;4_Plots/readme_example_nlrx.png&quot;</span>, <span class="dt">width=</span><span class="dv">16</span>, <span class="dt">height=</span><span class="dv">6</span>, <span class="dt">units=</span><span class="st">&quot;cm&quot;</span>, <span class="dt">res=</span><span class="dv">300</span>)</a>
<a class="sourceLine" id="cb6-10" title="10"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb6-11" title="11">nl_sp_plot &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(nl_sp<span class="op">$</span>spatial.raster, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb6-12" title="12">  t1 &lt;-<span class="st"> </span>x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb6-13" title="13">  t2 &lt;-<span class="st"> </span>x[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb6-14" title="14">  rst1_mod &lt;-<span class="st"> </span><span class="kw">overlay</span>(t1, t2, <span class="dt">fun =</span> <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb6-15" title="15">    x[(y[] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="kw">return</span>(x)</a>
<a class="sourceLine" id="cb6-17" title="17">  })</a>
<a class="sourceLine" id="cb6-18" title="18">  <span class="kw">plot</span>(rst1_mod, <span class="dt">colNA=</span><span class="st">&quot;black&quot;</span>)  </a>
<a class="sourceLine" id="cb6-19" title="19">})</a>
<a class="sourceLine" id="cb6-20" title="20"><span class="kw">dev.off</span>()</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-17"></span>
<img src="figures/application_nlrx01_fig01.png" alt="Plot of the three generated landscapes" width="944" />
<p class="caption">
Figure 4.6: Plot of the three generated landscapes
</p>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="funcpar.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dummy-chapter.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["EFForTS-LGraf.bookdown.pdf", "EFForTS-LGraf.bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
